---
# yaml-language-server: $schema=https://schemas.vzkn.eu/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name sentry-secret
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: bitwarden
  target:
    name: *name
    template:
      data:
        SENTRY_SECRET_KEY: "{{ .SECRET_KEY }}"
        ADMIN_PASSWORD: "{{ .ADMIN_PASSWORD }}"
        s3-access-key-id: "{{ .AWS_ACCESS_KEY_ID }}"
        s3-secret-access-key: "{{ .AWS_SECRET_ACCESS_KEY }}"
        mail-password: "{{ .SMTP_PASS }}"
        clickhouse-password: "{{ .CLICKHOUSE_PASSWORD }}"
        # openai-api-key: "{{ .OPENAI_API_KEY }}"  # Uncomment when AI features enabled
  dataFrom:
    - extract:
        key: sentry
    - extract:
        key: sentry-bucket
    - extract:
        key: protonmail
    - extract:
        key: clickhouse
        # - extract:
        #     key: ai-keys  # Uncomment when AI features enabled
---
# yaml-language-server: $schema=https://schemas.vzkn.eu/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name sentry-maxmind
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: bitwarden
  target:
    name: *name
    template:
      data:
        # Used by postBuild.substituteFrom in ks.yaml
        # accountID needs quotes to prevent YAML interpreting as number
        MAXMIND_ACCOUNT_ID: '"{{ .MAXMIND_USER_ID }}"'
        MAXMIND_LICENSE_KEY: "{{ .MAXMIND_LICENSE_KEY }}"
  dataFrom:
    - extract:
        key: maxmind
---
# yaml-language-server: $schema=https://schemas.vzkn.eu/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name sentry-github
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: bitwarden
  target:
    name: *name
    template:
      data:
        GITHUB_APP_ID: "{{ .GITHUB_APP_ID }}"
        GITHUB_APP_NAME: "sentry-vzkn-eu"
        GITHUB_PRIVATE_KEY: "{{ .GITHUB_PRIVATE_KEY }}"
        GITHUB_WEBHOOK_SECRET: "{{ .GITHUB_WEBHOOK_SECRET }}"
        GITHUB_CLIENT_ID: "{{ .GITHUB_CLIENT_ID }}"
        GITHUB_CLIENT_SECRET: "{{ .GITHUB_CLIENT_SECRET }}"
  dataFrom:
    - extract:
        key: sentry-github
  data:
    - secretKey: GITHUB_PRIVATE_KEY
      remoteRef:
        key: sentry-github-pk
        property: value
