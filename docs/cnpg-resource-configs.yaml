# CNPG Resource Configurations
# Generated from analysis of current CPGO clusters
# Use these values in postBuild.substitute sections

---
# Authentik - Largest cluster (2.5 GB)
authentik:
  APP: authentik
  CNPG_REPLICAS: '3'
  CNPG_IMAGE: ghcr.io/cloudnative-pg/postgresql:17.6-standard-trixie@sha256:e185037ad4c926fece1d3cfd1ec99680a862d7d02b160354e263a04a2d46b5f5
  CNPG_SIZE: 5Gi
  CNPG_STORAGECLASS: local-hostpath
  CNPG_REQUESTS_CPU: 500m
  CNPG_REQUESTS_MEMORY: 1Gi
  CNPG_LIMITS_MEMORY: 2Gi
  CNPG_MAX_CONNECTIONS: '300'
  CNPG_SHARED_BUFFERS: 512MB
  CNPG_DISABLED_SERVICES: "['ro', 'r']"
  # Reasoning: Largest DB, authentication critical, needs resources for auth queries

---
# Grafana - Observability, spiky usage
grafana:
  APP: grafana
  CNPG_REPLICAS: '3'
  CNPG_IMAGE: ghcr.io/cloudnative-pg/postgresql:17.6-standard-trixie@sha256:e185037ad4c926fece1d3cfd1ec99680a862d7d02b160354e263a04a2d46b5f5
  CNPG_SIZE: 2Gi
  CNPG_STORAGECLASS: local-hostpath
  CNPG_REQUESTS_CPU: 200m
  CNPG_REQUESTS_MEMORY: 512Mi
  CNPG_LIMITS_MEMORY: 1Gi
  CNPG_MAX_CONNECTIONS: '200'
  CNPG_SHARED_BUFFERS: 256MB
  CNPG_DISABLED_SERVICES: "['ro', 'r']"
  # Reasoning: Spiky CPU (up to 84m), dashboard queries need memory

---
# Radarr - Media management
radarr:
  APP: radarr
  CNPG_REPLICAS: '3'
  CNPG_IMAGE: ghcr.io/cloudnative-pg/postgresql:17.6-standard-trixie@sha256:e185037ad4c926fece1d3cfd1ec99680a862d7d02b160354e263a04a2d46b5f5
  CNPG_SIZE: 2Gi
  CNPG_STORAGECLASS: local-hostpath
  CNPG_REQUESTS_CPU: 100m
  CNPG_REQUESTS_MEMORY: 256Mi
  CNPG_LIMITS_MEMORY: 512Mi
  CNPG_MAX_CONNECTIONS: '100'
  CNPG_SHARED_BUFFERS: 128MB
  CNPG_DISABLED_SERVICES: "['ro', 'r']"
  # Reasoning: Medium DB (473 MB), moderate usage (11-15m CPU, 125-223 Mi RAM)

---
# Sonarr - Media management
sonarr:
  APP: sonarr
  CNPG_REPLICAS: '3'
  CNPG_IMAGE: ghcr.io/cloudnative-pg/postgresql:17.6-standard-trixie@sha256:e185037ad4c926fece1d3cfd1ec99680a862d7d02b160354e263a04a2d46b5f5
  CNPG_SIZE: 2Gi
  CNPG_STORAGECLASS: local-hostpath
  CNPG_REQUESTS_CPU: 100m
  CNPG_REQUESTS_MEMORY: 256Mi
  CNPG_LIMITS_MEMORY: 512Mi
  CNPG_MAX_CONNECTIONS: '100'
  CNPG_SHARED_BUFFERS: 128MB
  CNPG_DISABLED_SERVICES: "['ro', 'r']"
  # Reasoning: Medium DB (454 MB), variable usage (6-35m CPU)

---
# Jellystat - Media statistics
jellystat:
  APP: jellystat
  CNPG_REPLICAS: '3'
  CNPG_IMAGE: ghcr.io/cloudnative-pg/postgresql:17.6-standard-trixie@sha256:e185037ad4c926fece1d3cfd1ec99680a862d7d02b160354e263a04a2d46b5f5
  CNPG_SIZE: 2Gi
  CNPG_STORAGECLASS: local-hostpath
  CNPG_REQUESTS_CPU: 100m
  CNPG_REQUESTS_MEMORY: 256Mi
  CNPG_LIMITS_MEMORY: 512Mi
  CNPG_MAX_CONNECTIONS: '100'
  CNPG_SHARED_BUFFERS: 128MB
  CNPG_DISABLED_SERVICES: "['ro', 'r']"
  # Reasoning: Medium DB (531 MB), light usage (3-17m CPU, 167-237 Mi RAM)

---
# Prowlarr - Indexer management
prowlarr:
  APP: prowlarr
  CNPG_REPLICAS: '3'
  CNPG_IMAGE: ghcr.io/cloudnative-pg/postgresql:17.6-standard-trixie@sha256:e185037ad4c926fece1d3cfd1ec99680a862d7d02b160354e263a04a2d46b5f5
  CNPG_SIZE: 2Gi
  CNPG_STORAGECLASS: local-hostpath
  CNPG_REQUESTS_CPU: 100m
  CNPG_REQUESTS_MEMORY: 256Mi
  CNPG_LIMITS_MEMORY: 512Mi
  CNPG_MAX_CONNECTIONS: '100'
  CNPG_SHARED_BUFFERS: 128MB
  CNPG_DISABLED_SERVICES: "['ro', 'r']"
  # Reasoning: Small DB (308 MB), very light usage (10-15m CPU, 81-129 Mi RAM)

---
# Jellyseerr - Request management
jellyseerr:
  APP: jellyseerr
  CNPG_REPLICAS: '3'
  CNPG_IMAGE: ghcr.io/cloudnative-pg/postgresql:17.6-standard-trixie@sha256:e185037ad4c926fece1d3cfd1ec99680a862d7d02b160354e263a04a2d46b5f5
  CNPG_SIZE: 2Gi
  CNPG_STORAGECLASS: local-hostpath
  CNPG_REQUESTS_CPU: 100m
  CNPG_REQUESTS_MEMORY: 256Mi
  CNPG_LIMITS_MEMORY: 512Mi
  CNPG_MAX_CONNECTIONS: '100'
  CNPG_SHARED_BUFFERS: 128MB
  CNPG_DISABLED_SERVICES: "['ro', 'r']"
  # Reasoning: Small DB (285 MB), very light usage (2-25m CPU, 75-120 Mi RAM)

---
# Miniflux - RSS reader
miniflux:
  APP: miniflux
  CNPG_REPLICAS: '3'
  CNPG_IMAGE: ghcr.io/cloudnative-pg/postgresql:17.6-standard-trixie@sha256:e185037ad4c926fece1d3cfd1ec99680a862d7d02b160354e263a04a2d46b5f5
  CNPG_SIZE: 2Gi
  CNPG_STORAGECLASS: local-hostpath
  CNPG_REQUESTS_CPU: 100m
  CNPG_REQUESTS_MEMORY: 256Mi
  CNPG_LIMITS_MEMORY: 512Mi
  CNPG_MAX_CONNECTIONS: '100'
  CNPG_SHARED_BUFFERS: 128MB
  CNPG_DISABLED_SERVICES: "['ro', 'r']"
  # Reasoning: Small DB (393 MB), light usage (2-17m CPU, 117-157 Mi RAM)

---
# Atuin - Shell history
atuin:
  APP: atuin
  CNPG_REPLICAS: '3'
  CNPG_IMAGE: ghcr.io/cloudnative-pg/postgresql:17.6-standard-trixie@sha256:e185037ad4c926fece1d3cfd1ec99680a862d7d02b160354e263a04a2d46b5f5
  CNPG_SIZE: 2Gi
  CNPG_STORAGECLASS: local-hostpath
  CNPG_REQUESTS_CPU: 100m
  CNPG_REQUESTS_MEMORY: 256Mi
  CNPG_LIMITS_MEMORY: 512Mi
  CNPG_MAX_CONNECTIONS: '100'
  CNPG_SHARED_BUFFERS: 128MB
  CNPG_DISABLED_SERVICES: "['ro', 'r']"
  # Reasoning: Smallest DB (261 MB), minimal usage (1-19m CPU, 74-97 Mi RAM)

---
# Template for new small clusters (< 500 MB)
template_small:
  APP: your-app-name
  CNPG_REPLICAS: '3'
  CNPG_IMAGE: ghcr.io/cloudnative-pg/postgresql:17.6-standard-trixie@sha256:e185037ad4c926fece1d3cfd1ec99680a862d7d02b160354e263a04a2d46b5f5
  CNPG_SIZE: 2Gi
  CNPG_STORAGECLASS: local-hostpath
  CNPG_REQUESTS_CPU: 100m
  CNPG_REQUESTS_MEMORY: 256Mi
  CNPG_LIMITS_MEMORY: 512Mi
  CNPG_MAX_CONNECTIONS: '100'
  CNPG_SHARED_BUFFERS: 128MB
  CNPG_DISABLED_SERVICES: "['ro', 'r']"

---
# Template for new large clusters (> 2 GB)
template_large:
  APP: your-app-name
  CNPG_REPLICAS: '3'
  CNPG_IMAGE: ghcr.io/cloudnative-pg/postgresql:17.6-standard-trixie@sha256:e185037ad4c926fece1d3cfd1ec99680a862d7d02b160354e263a04a2d46b5f5
  CNPG_SIZE: 5Gi
  CNPG_STORAGECLASS: local-hostpath
  CNPG_REQUESTS_CPU: 500m
  CNPG_REQUESTS_MEMORY: 1Gi
  CNPG_LIMITS_MEMORY: 2Gi
  CNPG_MAX_CONNECTIONS: '300'
  CNPG_SHARED_BUFFERS: 512MB
  CNPG_DISABLED_SERVICES: "['ro', 'r']"

---
# Notes:
#
# 1. All configs use 3 replicas (same as CPGO) for proper HA quorum
# 2. CPU requests set based on actual usage + 2-4x headroom
# 3. Memory limits conservative to prevent OOM
# 4. max_connections reduced from default 600 (overkill for these apps)
# 5. shared_buffers set to ~25% of memory limit (PostgreSQL best practice)
# 6. Using Postgres 17.6 (latest stable at time of analysis)
# 7. disabled services 'ro' and 'r' to reduce K8s service overhead
#
# Usage in Kustomization:
#   postBuild:
#     substitute:
#       APP: miniflux
#       CNPG_REPLICAS: '3'
#       CNPG_SIZE: 2Gi
#       # ... etc
#   components:
#     - ../../../../components/cnpg/backup  # With backups
#     # or
#     - ../../../../components/cnpg/no-backup  # Without backups
