---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/source.toolkit.fluxcd.io/ocirepository_v1.json
apiVersion: source.toolkit.fluxcd.io/v1
kind: OCIRepository
metadata:
  name: minecraft
spec:
  interval: 5m
  layerSelector:
    mediaType: application/vnd.cncf.helm.chart.content.v1.tar+gzip
    operation: copy
  ref:
    tag: 4.26.4
  url: oci://ghcr.io/itzg/minecraft-server-charts/minecraft
---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/helm.toolkit.fluxcd.io/helmrelease_v2.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: &app minecraft-create
spec:
  chartRef:
    kind: OCIRepository
    name: minecraft
  dependsOn: []
  interval: 15m
  values:
    fullnameOverride: *app
    image:
      repository: ghcr.io/itzg/minecraft-server
      tag: 2025.10.1@sha256:bf07438096d4cd1b7588cb0e8714d666d1fbb2034ce38acd0d7285ff0648510b
    resources:
      requests:
        cpu: 200m
        memory: 2Gi
      limits:
        cpu: 4000m
        memory: 16Gi
    securityContext:
      runAsUser: 1000
      fsGroup: 100
    livenessProbe:
      initialDelaySeconds: 30
    readinessProbe:
      initialDelaySeconds: 30
    startupProbe:
        enabled: true
    extraEnv:
      TZ: Europe/Warsaw
    persistence:
      dataDir:
        enabled: true
        existingClaim: *app
    serviceAnnotations:
      external-dns.alpha.kubernetes.io/hostname: create.vzkn.eu
      external-dns.alpha.kubernetes.io/target: mc.vzkn.eu
      mc-router.itzg.me/externalServerName: create.vzkn.eu
    minecraftServer:
      eula: true
      version: 1.21.1
      type: FORGE
      overrideServerProperties: true
      jvmXXOpts: "-XX:MaxRAMPercentage=75"
      difficulty: normal
      spawnProtection: 0
      gameMode: survival
      pvp: false
      onlineMode: true
      # whitelist: "Vrozaksen"
      ops: "Vrozaksen"
      motd: "Just Create"
      worldSaveName: create
      viewDistance: 16
      pluginUrls:
        - https://cdn.modrinth.com/data/LNytGWDc/versions/5LpL274U/create-1.21.1-6.0.4.jar # Create
        - https://cdn.modrinth.com/data/t1VgucWo/versions/xC7Vc2qa/chunkloaders-1.2.8-neoforge-mc1.21.jar # Chunk Loaders
        - https://cdn.modrinth.com/data/U3eoZT3o/versions/QV78XqMj/infinitetrading-1.21.1-4.6.jar # Infinite Trading
        - https://cdn.modrinth.com/data/e0M1UDsY/versions/QZ8hTzIf/collective-1.21.1-8.7.jar # Collective
        - https://cdn.modrinth.com/data/Wnxd13zP/versions/jo7lDoK4/Clumps-neoforge-1.21.1-19.0.0.1.jar # Clumps
        - https://mediafilez.forgecdn.net/files/6888/880/mine-treasure-1.4.6.jar # Mine Treasure
        - https://cdn.modrinth.com/data/1bokaNcj/versions/DyuxZXfy/Xaeros_Minimap_25.2.10_NeoForge_1.21.jar # Xaero's Minimap
        - https://cdn.modrinth.com/data/NcUtCpym/versions/3WghnUq9/XaerosWorldMap_1.39.12_NeoForge_1.21.jar # Xaero's World Map
        - https://cdn.modrinth.com/data/nvQzSEkH/versions/43sRR8f6/Jade-1.21.1-NeoForge-15.10.3.jar # Jade
        - https://cdn.modrinth.com/data/xuDOzCLy/versions/Z9s9lM56/JadeAddons-1.21.1-NeoForge-6.1.0.jar # Jade Addons
        - https://cdn.modrinth.com/data/ordsPcFz/versions/pp2cY80Q/kotlinforforge-5.10.0-all.jar # Kotlin for Forge
        - https://cdn.modrinth.com/data/6PB3ZJCO/versions/AFTG7Qpv/item-despawn-timer-neoforge-0.2.2%2Bmc1.21.jar # Item Despawn Timer
        - https://cdn.modrinth.com/data/l6YH9Als/versions/v5qtqRQi/spark-1.10.124-neoforge.jar # Spark
        - https://cdn.modrinth.com/data/MnavVAzj/versions/m7nKsBUV/veinminer-2.4.5%2B1.21.1.jar # Veinminer
        - https://cdn.modrinth.com/data/Aqlf1Shp/versions/6cijwglm/forgified-fabric-api-0.115.6%2B2.1.3%2B1.21.1.jar # Forgified Fabric API
        - https://cdn.modrinth.com/data/u58R1TMW/versions/a4IkLwwg/connector-2.0.0-beta.10%2B1.21.1-full.jar # Connector
        - https://cdn.modrinth.com/data/RYtXKJPr/versions/8TgkUp5F/gravestone-neoforge-1.21.1-1.0.33.jar # Gravestone
        - https://cdn.modrinth.com/data/2M01OLQq/versions/psdIbUbg/shulkerboxtooltip-neoforge-5.1.6%2B1.21.1.jar # ShulkerBoxTooltip
        - https://cdn.modrinth.com/data/DjLobEOy/versions/MntMLupc/t_and_t-neoforge-fabric-1.13.2.jar # T&T
        - https://cdn.modrinth.com/data/cl223EMc/versions/oLp2OCg3/cristellib-neoforge-1.2.8.jar # CristelliLib
      rcon:
        enabled: true
  valuesFrom:
    - kind: Secret
      name: *app
      valuesKey: RCON_PASSWORD
      targetPath: minecraftServer.rcon.password
