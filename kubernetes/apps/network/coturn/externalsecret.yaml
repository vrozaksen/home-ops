---
# yaml-language-server: $schema=https://schemas.vzkn.eu/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: coturn-secret
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: bitwarden
  target:
    name: coturn-secret
    template:
      data:
        turnserver.conf: |
          # Listening ports
          listening-port=3478
          alt-listening-port=3479
          tls-listening-port=5349

          # Relay ports range (media streams)
          # ~100 ports = ~50 concurrent calls (2 ports per call)
          min-port=49152
          max-port=49252

          # Authentication
          use-auth-secret
          static-auth-secret={{ .TURN_SECRET }}

          # Realm
          realm=turn.vzkn.eu

          # TLS certificates (wildcard *.vzkn.eu)
          cert=/tls/tls.crt
          pkey=/tls/tls.key

          # Performance and security
          fingerprint
          no-multicast-peers
          no-cli
          no-loopback-peers
          no-tlsv1
          no-tlsv1_1

          # Logging
          verbose
          log-file=stdout
  dataFrom:
    - extract:
        key: coturn
