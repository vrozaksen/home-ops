# Gitleaks configuration for home-ops repository
title = "Home-ops GitLeaks Config"

[extend]
# Extend the base configuration
useDefault = true

[allowlist]
description = "Allowlist for known false positives in home-ops"

# Known safe files and patterns
paths = [
    '''github-deploy\.key\.pub$''',           # Public key files
    '''\.editorconfig$''',                    # Editor config
    '''\.taskfiles/''',                       # Task files
    '''docs/assets/''',                       # Documentation assets
    '''kubernetes/.*/helmrelease\.yaml$''',   # Helm releases with base64 encoded values
    '''bootstrap/''',                         # Bootstrap configurations
    '''\.pre-commit-config\.yaml$''',         # Pre-commit configuration file
]

# Known safe patterns that might trigger false positives
regexes = [
    '''password:\s*\{\{\s*\.Values\..*\}\}''',    # Helm template variables
    '''token:\s*\{\{\s*\.Values\..*\}\}''',       # Helm template variables
    '''key:\s*\{\{\s*\.Values\..*\}\}''',         # Helm template variables
    '''secretKeyRef:''',                          # Kubernetes secret references
    '''valueFrom:''',                             # Kubernetes value references
    '''secretName:\s*[a-zA-Z0-9-]+''',           # Kubernetes secret names
    '''"[A-Z0-9_]+_KEY":\s*"{{.*}}"''',          # Environment variable templates
    '''example\.com''',                           # Example domains
    '''recyclarr\\\.yml\$''',                     # Pre-commit config regex patterns
    '''\.yaml\$\|''',                             # Pre-commit config YAML patterns
    '''localhost''',                              # Localhost references
    '''127\.0\.0\.1''',                           # Localhost IP
    '''192\.168\.''',                             # Private IP ranges
    '''10\.''',                                   # Private IP ranges
    '''template:\s*\|''',                         # YAML multiline templates
]

# Known safe strings that might look like secrets
stopwords = [
    "example",
    "test",
    "demo",
    "sample",
    "placeholder",
    "template",
    "dummy",
    "fake",
    "mock",
    "changeme",
    "password",
    "secret",
    "token",
    "key",
]

[[rules]]
description = "Generic API Key"
id = "generic-api-key"
regex = '''(?i)(?:key|api[_-]?key|token|secret)(?:[0-9a-z\-_\t .]{0,20})(?:[\s|']|[\s|"]){0,3}(?:=|>|:=|\|\|:|<=|=>|:)(?:'|\"|\s|=|\x60){0,5}([0-9a-z\-_.=]{10,150})(?:['|\"|\n|\r|\s|\x60|;]|$)'''
secretGroup = 1
keywords = [
    "apikey",
    "api_key",
    "token",
    "secret",
]

[[rules]]
description = "High Entropy"
id = "high-entropy-string"
regex = '''[a-zA-Z0-9+/]{40,}={0,2}'''
secretGroup = 0
entropy = 3.5
keywords = [
    "password",
    "secret",
    "token",
    "key",
]

# Disable rules that are too noisy for this repository
[[rules]]
description = "Disabled AWS Access Key"
id = "aws-access-key-id"
regex = '''(A3T[A-Z0-9]|AKIA|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)[A-Z0-9]{16}'''
keywords = ["aws"]
# This rule is disabled by setting entropy very high
entropy = 8.0
