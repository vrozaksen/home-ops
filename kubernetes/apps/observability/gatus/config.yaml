---
connectivity:
  checker:
    target: 1.1.1.1:53
    interval: 1m

endpoints:
  - name: Cloudflare
    group: connectivity
    url: icmp://1.1.1.1
    interval: 1m
    conditions:
      - "[CONNECTED] == true"

  - name: Google
    group: connectivity
    url: icmp://8.8.8.8
    interval: 1m
    conditions:
      - "[CONNECTED] == true"

  - name: Quad9
    group: connectivity
    url: icmp://9.9.9.9
    interval: 1m
    conditions:
      - "[CONNECTED] == true"

  - name: cert-expiration
    group: domain
    url: "https://status.vzkn.eu"
    interval: 1h
    conditions:
      - "[CERTIFICATE_EXPIRATION] > 240h"

  - name: trivy-critical-vulnerabilities
    group: security
    url: "http://prometheus-operated.observability.svc.cluster.local:9090/api/v1/query?query=sum(trivy_image_vulnerabilities{severity='Critical'})"
    interval: 1h
    conditions:
      - "[BODY].data.result[0].value[1] < 50"  # Alert if more than 50 critical CVEs
      - "[STATUS] == 200"

  - name: trivy-high-vulnerabilities
    group: security
    url: "http://prometheus-operated.observability.svc.cluster.local:9090/api/v1/query?query=sum(trivy_image_vulnerabilities{severity='High'})"
    interval: 6h
    conditions:
      - "[BODY].data.result[0].value[1] < 200"  # Alert if more than 200 high CVEs
      - "[STATUS] == 200"

  - name: tetragon-agent-health
    group: security
    url: "http://tetragon.security.svc.cluster.local:6789"
    interval: 1m
    conditions:
      - "[STATUS] == 200"

  - name: tetragon-process-events
    group: security
    url: "http://prometheus-operated.observability.svc.cluster.local:9090/api/v1/query?query=rate(tetragon_events_total{event_type='PROCESS_EXEC'}[5m])"
    interval: 5m
    conditions:
      - "[BODY].data.result[0].value[1] > 0"  # Ensure events are being collected
      - "[STATUS] == 200"

  - name: tetragon-policy-loaded
    group: security
    url: "http://prometheus-operated.observability.svc.cluster.local:9090/api/v1/query?query=tetragon_policy_loaded"
    interval: 5m
    conditions:
      - "[BODY].data.result[0].value[1] > 0"  # Ensure TracingPolicies are loaded
      - "[STATUS] == 200"

metrics: true

storage:
  type: sqlite
  caching: true
  path: ${GATUS_CONFIG_PATH}/gatus.db

ui:
  header: Status
  title: Status | Gatus
  default-sort-by: group
  link: https://github.com/vrozaksen
  buttons:
    - name: Github
      link: https://github.com/vrozaksen
    - name: Homelab
      link: https://github.com/vrozaksen/home-ops

web:
  port: ${GATUS_WEB_PORT}
